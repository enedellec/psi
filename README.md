# VM creation in azure
- Go to [Microsoft Azure Portal](https://portal.azure.com)
- SGX enabled VM are not available with the free subscription, so you must pay for the usage of such VMs
- You will need to create a [SSH Key](https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FsshPublicKeys) that you will store in Azure
- Launch a Cloud Shell, and upload the files located in the `azure` folder, or clone the source code of the project : `git clone https://github.com/enedellec/psi.git` in order to access to the files located in the `azure` folder
- Replace the strings `ssh-rsa XXXX generated-by-azure` in both `parameters-server.json` and `parameters-client.json` files by your own SSH public key, which has been generated by Azure
- In your `$HOME` folder, create a `key.pem` file containing your private SSH key generated by Azure 
- Launch the `deploy.sh` script in order to create two differents VM
- If you face some issues like `bash: ./deploy.sh: /bin/bash^M: bad interpreter: No such file or directory`, you can delete the `^M` character using that command `sed -i -e 's/\r$//' deploy.sh`
- Open a new Cloud Shell, and connect on both VM by launching `./connect-client.sh` in one terminal, and `./connect-server.sh` in the other one
- Copy the `install.sh` file in the two VM, and launch that script in order to install EGO and libPSI

# Without enclaves
- Select one the VM created above, and open three terminals
- For the first one, enter the following command
```
cd ~/psi/without-enclaves/server
go run .
```
- For the second one, enter the following command:
```
cd ~/psi/without-enclaves/client
go run . --file=../../data/data-100-all.csv
```
- For the first one, enter the following command:
```
cd ~/psi/without-enclaves/server
go run .
```
- For the third one, enter the following command:
```
cd ~/psi/without-enclaves/client
go run . --file=../../data/data-100-all.csv
```

If you want to test from two different VM, you can specify the `remoteURL` parameter as below:
```
cd ~/psi/without-enclaves/client
go run . --file=../../data/data-100-all.csv --remoteURL=http://1.2.3.4:8080/upload
```

